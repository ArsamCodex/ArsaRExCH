@page "/BtcUsdt20"
@using Microsoft.AspNetCore.SignalR.Client
@inject NavigationManager Navigation

<div>
    <p>Current BTC Price: @btcPrice</p>
    <p>Current ETH Price: @ethPrice</p>
</div>

@code {
    private HubConnection? hubConnection;
    private decimal btcPrice;
    private decimal ethPrice;

    protected override async Task OnInitializedAsync()
    {
        // Create the SignalR connection
        hubConnection = new HubConnectionBuilder()
            .WithUrl(Navigation.ToAbsoluteUri("/pricehub")) // Ensure this matches your hub URL
            .Build();

        // Register the method to receive price updates
        hubConnection.On<decimal, decimal>("ReceivePrices", (btc, eth) =>
        {
            btcPrice = btc;
            ethPrice = eth;
            InvokeAsync(StateHasChanged); // Update the UI
        });

        await hubConnection.StartAsync(); // Start the connection
    }

    public async ValueTask DisposeAsync()
    {
        if (hubConnection is not null)
        {
            await hubConnection.DisposeAsync(); // Dispose the connection
        }
    }
}