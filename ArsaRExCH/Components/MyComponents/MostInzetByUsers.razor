@inject ArsaRExCH.Interface.UserIpInterface _user
@using ArsaRExCH.Model
@using ArsaRExCH.DTOs
@using ArsaRExCH.Components.Pages
@using ArsaRExCH.Components.MyComponents
@rendermode InteractiveServer

<h3>Most Inzet</h3>

@if (isLoading)
{
    <p>Loading...</p>
}
else
{
    <div class="table-container">
        <div class="table-header">
            <div class="table-row">
                <div class="table-cell">Date</div>
                <div class="table-cell">BTC Target Price</div>
                <div class="table-cell">Total BTC Inzet</div>
                <div class="table-cell">ETH Target Price</div>
                <div class="table-cell">Total ETH Inzet</div>
            </div>
        </div>
        <div class="table-body">
            @if (results != null && results.Any())
            {
                foreach (var result in results)
                {
                    <div class="table-row">
                        <div class="table-cell">@result.MyDateTime.ToString("dd/MM/yyyy")</div>
                        <div class="table-cell">@((result.HitBtcPrice != 0) ? result.HitBtcPrice.ToString() : "N/A")</div>
                        <div class="table-cell">@((result.MaxBtcTotalInBTC != 0) ? result.MaxBtcTotalInBTC.ToString() : "N/A")</div>
                        <div class="table-cell">@((result.HitEthPrice != 0) ? result.HitEthPrice.ToString() : "N/A")</div>
                        <div class="table-cell">@((result.MaxEthTotal != 0) ? result.MaxEthTotal.ToString() : "N/A")</div>
                    </div>
                }
            }
            else
            {
                <div class="table-row">
                    <div class="table-cell" colspan="6">No results available.</div>
                </div>
            }
        </div>
    </div>
}
<style>
    .table {
        display: flex;
        flex-direction: column;
        width: 100%;
        border: 1px solid #ddd;
        margin-top: 10px;
    }

    .table-header {
        font-weight: bold;
        background-color: #f9f9f9;
    }

    .table-row {
        display: flex;
        border-bottom: 1px solid #ddd;
    }

        .table-row:last-child {
            border-bottom: none;
        }

    .table-cell {
        flex: 1;
        padding: 10px;
        text-align: left;
        border-right: 1px solid #ddd;
    }

        .table-cell:last-child {
            border-right: none;
        }

    .table-header .table-cell {
        background-color: #f1f1f1;
        text-align: center;
    }

    .table-body .table-row:nth-child(even) .table-cell {
        background-color: #f9f9f9;
    }
    </style>

@code {
    private List<MaxInzetResultDTO> results = new List<MaxInzetResultDTO>();
    private bool isLoading = false;

    protected override async Task OnInitializedAsync()
    {
       
        Console.WriteLine("OnInitializedAsync called"); //  debugging

            results = await _user.CalculateMaxInzetAsync(); // Fetch all results

    }
}
